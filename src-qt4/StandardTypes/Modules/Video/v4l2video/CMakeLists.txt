SET(CMAKE_INSTALL_PREFIX /opt/iqr)
SET(CMAKE_VERBOSE_MAKEFILE TRUE) 

ADD_DEFINITIONS(-DQT_THREAD_SUPPORT -D_REENTRANT -DQT_NO_DEBUG -DIQRMODULE)

SET(QT_MT_REQUIRED TRUE)
FIND_PACKAGE(Qt4 REQUIRED)


IF(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")

SET (libSrcMonochrome 
  moduleV4L2Video.cpp
  ../Common/v4ldemos/v4l.c
  ${CMAKE_CURRENT_SOURCE_DIR}/../Common/ccvt-0.3/ccvt_misc.c
)
SET (libSrcColor 
  moduleV4L2Video.cpp
  ../Common/v4ldemos/v4l.c
  ${CMAKE_CURRENT_SOURCE_DIR}/../Common/ccvt-0.3/ccvt_misc.c
)
ELSE(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")

SET (libSrcMonochrome 
  moduleV4L2Video.cpp
  ../Common/v4ldemos/v4l.c
  ${CMAKE_CURRENT_SOURCE_DIR}/../Common/ccvt-0.3/ccvt_c2.c
)
SET (libSrcColor 
  moduleV4L2Video.cpp
  ../Common/v4ldemos/v4l.c
  ${CMAKE_CURRENT_SOURCE_DIR}/../Common/ccvt-0.3/ccvt_c2.c
)
ENDIF(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")



IF(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")
#this hack is needed because cmake currently does not support assembler files...
ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/ccvt_mmx.o
 COMMAND gcc -c -I. -I/lib/modules/`uname -r`/build/include -I/lib/modules/`uname -r`/source/include ${CMAKE_CURRENT_SOURCE_DIR}/../Common/ccvt-0.3/ccvt_mmx.S
 DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/../Common/ccvt-0.3/ccvt_mmx.S )
ENDIF(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")


INCLUDE_directories(
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${CMAKE_CURRENT_SOURCE_DIR}/../Common
  ${CMAKE_CURRENT_SOURCE_DIR}/../Common/v4ldemos
  ${CMAKE_CURRENT_SOURCE_DIR}/../../../../
  ${CMAKE_CURRENT_SOURCE_DIR}/../../../../FE/icons/ModuleIcons/
  ${QT_INCLUDE_DIR}
)


IF(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")
ADD_LIBRARY(moduleV4L2Monochrome SHARED ${libSrcMonochrome} ccvt_mmx.o)
ADD_LIBRARY(moduleV4L2Color SHARED ${libSrcColor} ccvt_mmx.o)
ELSE(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")
ADD_LIBRARY(moduleV4L2Monochrome SHARED ${libSrcMonochrome})
ADD_LIBRARY(moduleV4L2Color SHARED ${libSrcColor})
ENDIF(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i486" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i586" OR 
    ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")


SET_TARGET_PROPERTIES(moduleV4L2Monochrome PROPERTIES PREFIX "" DEFINE_SYMBOL MODULE_MONOCHROME)
SET_TARGET_PROPERTIES(moduleV4L2Color PROPERTIES PREFIX "" DEFINE_SYMBOL MODULE_COLOR)

INSTALL(TARGETS 
  moduleV4L2Monochrome
  moduleV4L2Color
#  LIBRARY DESTINATION lib/Modules/ 
  LIBRARY DESTINATION lib/iqr/Modules/
  ARCHIVE DESTINATION lib/iqr/Modules/
  RUNTIME DESTINATION bin 
 
)



 


